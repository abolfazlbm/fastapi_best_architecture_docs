import{_ as i,c as a,e as n,o as l}from"./app-BmTAx6X_.js";const e={};function h(p,s){return l(),a("div",null,s[0]||(s[0]=[n(`<div class="vp-steps"><ol><li><p>拉取代码到服务器</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-shell"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">git</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> clone</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> https://github.com/fastapi-practices/fastapi_best_architecture_ui.git</span></span></code></pre></div></li><li><p>env</p><p>修改 <code>/apps/web-antd/.env.production</code> 中的 <code>VITE_GLOB_API_URL</code> 为域名地址（末尾不带斜杠）</p></li><li><p>更新 nginx 配置</p><p>进入 <code>/scripts/deploy/nginx.conf</code> 目录，修改 <code>nginx.conf</code> 文件</p><div class="language-nginx line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="nginx" style="--vp-collapsed-lines:12;--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light has-highlighted vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">worker_processes </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">auto;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">pid </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/run/nginx.pid;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">error_log </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/var/log/nginx/error.log;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">include </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/usr/share/nginx/modules/*.conf;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">events</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> {</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    worker_connections </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">8192</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">http</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> {</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    include </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/etc/nginx/mime.types;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    default_type </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">application/octet-stream;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    sendfile </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">on</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    client_max_body_size </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">5M</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    client_body_buffer_size </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">5M</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    gzip </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">on</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    gzip_comp_level </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">2</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    gzip_types </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">text/plain text/css text/javascript application/javascript application/x-javascript application/xml application/x-httpd-php image/jpeg image/gif image/png;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    gzip_vary </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">on</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    keepalive_timeout </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">300</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    access_log </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/var/log/nginx/access.log;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 添加 https conf</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    server</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> { </span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">         listen </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">80</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">         listen </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">[::]:80;</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">         # xxx.com 应该与 .env.production 中的配置保持一致</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">         server_name </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">xxx.com;</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">         rewrite</span><span style="--shiki-dark:#E06C75;--shiki-light:#0184BC;"> ^(.*)$</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> https://$</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">host</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">$</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">1</span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;"> permanent</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    server</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> {</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">        # 删除下面两行</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">        # 更新为与上面 server_name 相同</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        server_name </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 127.0.0.1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">        # 添加 https conf</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        listen </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">443</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> ssl; </span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        ssl_certificate </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/etc/ssl/xxx.pem;  </span><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;"># 证书</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        ssl_certificate_key </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/etc/ssl/xxx.key;  </span><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;"># 密钥</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        ssl_ciphers </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        ssl_protocols </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">TLSv1 TLSv1.1 TLSv1.2;</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        ssl_prefer_server_ciphers </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">on</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        client_max_body_size </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  5m</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        root </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/var/www/fba_ui;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        location</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> / {</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            try_files </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">$</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">uri</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">uri</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/ /index.html;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        location</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> /api/v1/ {</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_pass </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">http://fba_server:8001;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">Host $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">http_host</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">X-Real-IP $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">remote_addr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">X-Forwarded-For $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">proxy_add_x_forwarded_for</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">X-Forwarded-Proto $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">scheme</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_connect_timeout </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">300s</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_send_timeout </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">300s</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_read_timeout </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">300s</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        location</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> /ws/socket.io/ {</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_pass </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">http://fba_server:8001/ws/socket.io/;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">Host $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">host</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">X-Real-IP $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">remote_addr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">X-Forwarded-For $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">proxy_add_x_forwarded_for</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">X-Forwarded-Proto $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">scheme</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_read_timeout </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">86400s</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_send_timeout </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">86400s</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">            # WebSocket 支持</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_http_version </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">1.1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">Upgrade $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">http_upgrade</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">Connection </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&quot;upgrade&quot;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_buffering </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">off</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        location</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> /flower/ {</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_pass </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">http://fba_server:8555;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">Host $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">http_host</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">X-Real-IP $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">remote_addr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">X-Forwarded-For $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">proxy_add_x_forwarded_for</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">X-Forwarded-Proto $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">scheme</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_connect_timeout </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">300s</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_send_timeout </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">300s</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_read_timeout </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">300s</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_redirect </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">off</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">            # WebSocket 支持</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_http_version </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">1.1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">Upgrade $</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">http_upgrade</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            proxy_set_header </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">Connection </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&quot;upgrade&quot;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        location</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> /static/ {</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            alias </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/var/www/fba_server/backend/static;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        location</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> /static/upload/ {</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            alias </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/var/www/fba_server/backend/static/upload;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        error_page </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">500</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 502</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 503</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 504</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> /50x.html;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        location</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> = </span><span style="--shiki-dark:#E06C75;--shiki-light:#0184BC;">/50x.html </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">{</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">            root </span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">/usr/share/nginx/html;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        }</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    }</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div></li><li><p>更新脚本文件</p><div class="hint-container caution"><p class="hint-container-title">前端独立 docker-compose 构建条件</p><ol><li>注释了 fba 后端 docker-compose 脚本中的 fba_ui 容器</li><li>已经通过 docker-compose 构建 fba 后端</li></ol></div><div class="language-yaml line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="yaml" style="--vp-collapsed-lines:12;--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light has-highlighted vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">networks</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">  fba_network</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # name: fba_network</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # driver: bridge</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    external</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">: </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">volumes</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">  fba_static</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    external</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">: </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">true</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">  fba_static_upload</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    external</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">: </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">services</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">  fba_ui</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    build</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">      context</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">: </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">.</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">      dockerfile</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">: </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">Dockerfile</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    image</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">: </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">fba_ui:latest</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    ports</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">      - </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&quot;80:80&quot;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">      - </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&quot;443:443&quot;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    container_name</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">: </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">fba_ui</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    restart</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">: </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">always</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    command</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">      - </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">nginx</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">      - </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">-g</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">      - </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">daemon off;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    volumes</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">       # nginx https conf</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">       # 通过 docker 进行部署时，需要打开此配置项并确保&lt;挂载到容器内的证书文件路径&gt;配置</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">       # 与 nginx conf 中的 ssl 证书文件路径配置一致，如果你直接将 ssl 证书文件 cp</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">       # 到了 docker 容器内，则无需挂载证书文件，直接将它们注释或删除即可</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">       # local_ssl_pem_path：你在服务器存放 ssl pem 证书文件的路径，自行修改</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">       # local_ssl_key_path: 你在服务器存放 ssl key 证书文件的路径，自行修改</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">       # /etc/ssl/xxx.pem：挂载到容器内 ssl pem 证书文件的路径，自行修改</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">       # /etc/ssl/xxx.key：挂载到容器内 ssl key 证书文件的路径，自行修改</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">      - </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">local_ssl_pem_path:/etc/ssl/xxx.pem</span></span>
<span class="line highlighted warning"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">      - </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">local_ssl_key_path:/etc/ssl/xxx.key</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">      - </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">fba_static:/www/fba_server/backend/static</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">    networks</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">      - </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">fba_network</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div></li><li><p>构建并启动容器</p><p>创建网络</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-shell"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">docker</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> network</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> create</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> fba_network</span></span></code></pre></div><p>构建</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-shell"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">docker-compose</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> build</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> fba_ui</span></span></code></pre></div><p>启动</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-shell"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">docker-compose</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> run</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> fba_ui</span></span></code></pre></div></li></ol></div>`,1)]))}const k=i(e,[["render",h]]),d=JSON.parse('{"path":"/frontend/docker.html","title":"Docker 部署","lang":"zh-CN","frontmatter":{"title":"Docker 部署","description":"拉取代码到服务器 env 修改 /apps/web-antd/.env.production 中的 VITE_GLOB_API_URL 为域名地址（末尾不带斜杠） 更新 nginx 配置 进入 /scripts/deploy/nginx.conf 目录，修改 nginx.conf 文件 更新脚本文件 前端独立 docker-compose 构建条件 注...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Docker 部署\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://fastapi-practices.github.io/fastapi_best_architecture_docs/fastapi_best_architecture_docs/frontend/docker.html"}],["meta",{"property":"og:site_name","content":"FastAPI Best Architecture"}],["meta",{"property":"og:title","content":"Docker 部署"}],["meta",{"property":"og:description","content":"拉取代码到服务器 env 修改 /apps/web-antd/.env.production 中的 VITE_GLOB_API_URL 为域名地址（末尾不带斜杠） 更新 nginx 配置 进入 /scripts/deploy/nginx.conf 目录，修改 nginx.conf 文件 更新脚本文件 前端独立 docker-compose 构建条件 注..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}]]},"readingTime":{"minutes":1.27,"words":381},"git":{"createdTime":1748532855000},"autoDesc":true,"filePathRelative":"frontend/docker.md","headers":[],"categoryList":[{"id":"aca33b","sort":10006,"name":"frontend"}],"bulletin":true}');export{k as comp,d as data};
